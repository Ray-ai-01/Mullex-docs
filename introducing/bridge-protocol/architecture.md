# Architecture

### **System Architecture**

Mullex Protocol 采用经过验证的“链上合约+链下中继”混合架构。该设计在保证区块链不可篡改性的核心安全前提下，通过链下组件优化了效率和成本。整个系统由三大核心层组成：智能合约层、链下服务层和用户界面层。



### **架构概述**

Mullex 的跨链流程本质上是经过验证的消息传递。其核心架构体现了智能合约与链下中继器如何协同完成跨链操作：



**智能合约层 (Smart Contract Layer)**

这是整个协议的安全基石，所有资产的核心操作都发生在此层。

* **1. 桥接合约 (Bridge Contract):**
  * **功能:** 这是用户直接交互的主合约。它负责：
    * **资产处理:** 执行资产的 `Lock`/`Unlock`（对于USDC）或 `Mint`/`Burn`（对于muUSD）。
    * **事件发射:** 在资产操作完成后，发射包含跨链详情（如接收链、接收地址、金额、唯一Nonce）的 `MessageSent` 事件。这是链下中继器工作的信号源。
    * **消息验证:** 接收来自中继器提交的消息和签名，并验证其有效性。只有通过验证的消息才能触发目标链的相应操作。
* **2. 代币合约 (Token Contracts):**
  * **USDC 合约:** 标准的第三方代币合约。我们的桥接合约需要获得用户授权（Approve）后才能操作其中的USDC。
  * **muUSD 合约:** 由 Mullex 自行发行的符合ERC-20标准的代币合约。它内置了 `Mint` 和 `Burn` 函数，并严格限制只能由我们的桥接合约调用，以确保其 1:1 的抵押属性。
* **3. 流动性池合约 (Liquidity Pool Contract) (针对如USDC模型):**
  * **功能:** 一个专门用于管理流动性提供者（LP）资金的合约。它负责：
    * **记录存款:** 接收LP存入的USDC并记录其份额。
    * **发放LP Token:** 向LP发行代表其份额的凭证（ 如`muUSDC`）。
    * **处理跨链支付:** 当用户从源链跨入时，从此合约中提取USDC支付给目标链用户。



**链下服务层 (Off-Chain Service Layer)**

这是协议的“神经系统”，负责监听事件、处理消息并连接不同的区块链。

* **1. 中继器 (Relayer):**
  * **功能:** 这是最重要的链下组件。它是一个持续运行的服务，执行以下关键任务：
    * **事件监听:** 持续扫描源链（如 Ethereum）上 Mullex 合约发出的 `MessageSent` 事件。
    * **消息签名:** 获取事件数据后，使用其私钥对消息（包括目标链地址、金额、Nonce等）进行签名，生成 cryptographic proof（加密证明）。
    * **消息传递:** 将原始消息和生成的签名作为 proof 提交到目标链（如 Metis）的桥接合约上。
  * **部署模式:** 为提高去中心化和抗审性，应由多个独立运营的中继器节点组成一个网络。可以采用轮询或基于信誉的机制来选择中继器，避免单点故障。
* **2. 预言机 (Oracle) (可选但推荐):**
  * **功能:** 为一个额外的安全层。它可以为目标链合约提供源链的区块头信息，使合约能够自行验证交易是否在源链上得到足够确认，而不仅仅依赖于中继器提交的签名。这进一步减少了对中继器的信任假设。
* **3. API 服务 (API Service):**
  * **功能:** 为前端界面提供数据支持。
    * **费率和余额查询:** 为用户计算并显示实时的预估手续费。
    * **交易状态查询:** 提供跨链交易的实时状态（如“等待确认”、“中继中”、“已完成”）。
    * **历史记录:** 存储并展示用户的跨链历史。



**用户界面层 (User Interface Layer)**

* **Web 前端 (Web Frontend):**
  * **功能:** 一个直观的前端框架构建的网站（[bridge.mullex.io](https://bridge.mullex.io/mubridge/)）。
  * **交互:** 与用户钱包（如 MetaMask）连接，引导用户完成跨链步骤：选择链、输入金额、显示手续费、确认交易。
  * **状态展示:** 清晰地向用户展示每一步的状态，降低不确定性。

